import{c as E,d as be,D as ye,f,w as m,b as s,a as i,r as d,o as n,h as o,u as a,S as he,F as P,j as Y,g as $,p as H,t as k,z as $e,e as C,P as Ce,m as Pe,q as Me,A as ke,H as Ge,U as Ze,V as Ke,x as w,W as et,O as tt,i as st,n as ne,s as nt,X as ze}from"./app-Cm7fpTJU.js";import{_ as le}from"./Modal.vue_vue_type_script_setup_true_lang-FMLRwBJl.js";import{I as j,H as at,Y as q,_ as lt,f as ot,g as pe,M as it,y as rt}from"./craft-ui-h9Wa1769.js";import{L as V}from"./loader-circle-gaVCOWsb.js";import{G as je}from"./globe-BTV0GYGL.js";import{_ as ct}from"./DnsSettings.vue_vue_type_script_setup_true_lang-hcBKQi19.js";import{C as ut}from"./circle-alert-yUByV0C6.js";import{E as dt}from"./eye-DYJMv-Oh.js";import{R as me}from"./refresh-cw-BiTqhJDC.js";import{T as Se}from"./trash-2-uwfuk5gL.js";import{X as vt}from"./x-qKiKrROT.js";const ge=E("container",[["path",{d:"M22 7.7c0-.6-.4-1.2-.8-1.5l-6.3-3.9a1.72 1.72 0 0 0-1.7 0l-10.3 6c-.5.2-.9.8-.9 1.4v6.6c0 .5.4 1.2.8 1.5l6.3 3.9a1.72 1.72 0 0 0 1.7 0l10.3-6c.5-.3.9-1 .9-1.5Z",key:"1t2lqe"}],["path",{d:"M10 21.9V14L2.1 9.1",key:"o7czzq"}],["path",{d:"m10 14 11.9-6.9",key:"zm5e20"}],["path",{d:"M14 19.8v-8.1",key:"159ecu"}],["path",{d:"M18 17.5V9.4",key:"11uown"}]]);const ae=E("database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);const pt=E("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);const mt=E("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);const fe=E("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);const Ve=E("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]]);const ft=E("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]);const ht=E("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);const _e=E("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);const gt=E("wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]),bt={class:"p-6"},yt={key:0,class:"py-12 text-center"},xt={key:1,class:"py-12 text-center"},wt={key:2,class:"space-y-8"},kt={key:0},zt={class:"text-xs font-semibold text-zinc-500 uppercase tracking-wider mb-4 px-1"},St={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},_t={class:"flex items-start justify-between mb-2"},$t={class:"w-10 h-10 rounded-lg bg-zinc-800 flex items-center justify-center text-zinc-400 group-hover:text-lime-400 group-hover:bg-lime-400/10 transition-colors"},Ct={key:0,class:"text-[10px] font-bold uppercase tracking-tight px-1.5 py-0.5 rounded bg-zinc-800 text-zinc-500 border border-zinc-700"},Pt={class:"text-white font-medium mb-1"},Mt={class:"text-sm text-zinc-500 line-clamp-2 mb-4"},jt=be({__name:"AddServiceModal",props:{show:{type:Boolean},getApiUrl:{type:Function},csrfToken:{}},emits:["close","serviceEnabled"],setup(U,{emit:I}){const b=U,D=I,F=d(!0),T=d([]),z=d(null),S=[{key:"core",label:"Core Services"},{key:"php",label:"PHP Servers"},{key:"database",label:"Databases"},{key:"utility",label:"Utilities"}],M=H(()=>{const v={core:[],php:[],database:[],utility:[]};return T.value.forEach(c=>{v[c.category]?v[c.category].push(c):v.utility.push(c)}),v}),A=async()=>{F.value=!0;try{const c=await(await fetch(b.getApiUrl("/services/available"))).json();c.success&&(T.value=c.data||[])}catch(v){console.error("Failed to fetch available services:",v)}finally{F.value=!1}},L=async v=>{z.value=v;try{const r=await(await fetch(b.getApiUrl(`/services/${v}/enable`),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":b.csrfToken}})).json();r?.success?(D("serviceEnabled",v),D("close")):alert("Failed to enable service: "+(r?.error||"Unknown error"))}catch{alert("Failed to enable service")}finally{z.value=null}},W=v=>{switch(v){case"core":return je;case"database":return ae;case"php":return ge;case"utility":return Ve;default:return he}};return ye(()=>b.show,v=>{v&&A()},{immediate:!0}),(v,c)=>(n(),f(le,{show:U.show,title:"Add Service",maxWidth:"max-w-2xl",onClose:c[0]||(c[0]=r=>v.$emit("close"))},{default:m(()=>[s("div",bt,[F.value?(n(),i("div",yt,[o(a(V),{class:"w-8 h-8 mx-auto text-zinc-600 animate-spin mb-3"}),c[1]||(c[1]=s("p",{class:"text-zinc-500"},"Discovering available services...",-1))])):T.value.length===0?(n(),i("div",xt,[o(a(he),{class:"w-8 h-8 mx-auto text-zinc-700 mb-3"}),c[2]||(c[2]=s("p",{class:"text-zinc-500"},"No additional services available at this time.",-1))])):(n(),i("div",wt,[(n(),i(P,null,Y(S,r=>(n(),i(P,{key:r.key},[M.value[r.key].length>0?(n(),i("div",kt,[s("h4",zt,k(r.label),1),s("div",St,[(n(!0),i(P,null,Y(M.value[r.key],p=>(n(),i("div",{key:p.name,class:"p-4 rounded-xl border border-zinc-800 bg-zinc-900/50 hover:bg-zinc-800/50 hover:border-zinc-700 transition-all group flex flex-col justify-between"},[s("div",null,[s("div",_t,[s("div",$t,[(n(),f($e(W(p.category)),{class:"w-5 h-5"}))]),p.required?(n(),i("span",Ct," Required ")):$("",!0)]),s("h5",Pt,k(p.label),1),s("p",Mt,k(p.description),1)]),o(a(j),{onClick:y=>L(p.name),disabled:z.value!==null,variant:"secondary",class:"w-full justify-center"},{default:m(()=>[z.value===p.name?(n(),i(P,{key:0},[o(a(V),{class:"w-4 h-4 animate-spin mr-2"}),c[3]||(c[3]=C(" Enabling... ",-1))],64)):(n(),i(P,{key:1},[o(a(Ce),{class:"w-4 h-4 mr-2"}),c[4]||(c[4]=C(" Add Service ",-1))],64))]),_:2},1032,["onClick","disabled"])]))),128))])])):$("",!0)],64))),64))]))])]),_:1},8,["show"]))}}),Vt={class:"p-6"},At={key:0,class:"py-12 text-center"},Tt={key:1,class:"py-12 text-center"},Ut={key:2},Ft=["for"],Et={key:0,class:"ml-1 text-[10px] text-zinc-500 uppercase"},Lt={key:0,class:"relative"},Rt=["id","onUpdate:modelValue"],Nt=["value"],Ht={key:1,class:"flex items-center"},Ot={class:"ml-3 text-sm text-zinc-400"},qt={key:2,class:"relative"},It=["id","type","onUpdate:modelValue","placeholder"],Dt=["onClick"],Wt={key:3,class:"text-xs text-zinc-500"},Bt={class:"pt-4 flex items-center justify-end gap-3 border-t border-zinc-800"},Xt=be({__name:"ConfigureServiceModal",props:{show:{type:Boolean},serviceName:{},environmentId:{},getApiUrl:{type:Function},csrfToken:{}},emits:["close","configUpdated"],setup(U,{emit:I}){const b=U,D=I,F=d(!0),T=d(!1),z=d(null),S=d({}),M=d({}),A=H(()=>b.serviceName==="dns"),L=async()=>{if(b.serviceName){F.value=!0;try{const r=await(await fetch(b.getApiUrl(`/services/${b.serviceName}/info`))).json();if(r.success&&r.data){z.value=r.data,S.value={...r.data.config};const p={};Object.entries(r.data.configSchema).forEach(([y,_])=>{_.secret&&(p[y]=!1)}),M.value=p}}catch(c){console.error("Failed to fetch service info:",c)}finally{F.value=!1}}},W=async()=>{if(b.serviceName){T.value=!0;try{const r=await(await fetch(b.getApiUrl(`/services/${b.serviceName}/config`),{method:"POST",headers:{"X-CSRF-TOKEN":b.csrfToken,"Content-Type":"application/json"},body:JSON.stringify({config:S.value})})).json();r.success?(D("configUpdated",b.serviceName),D("close")):alert("Failed to update configuration: "+(r.error||"Unknown error"))}catch{alert("Failed to update configuration")}finally{T.value=!1}}},v=c=>{M.value[c]=!M.value[c]};return ye(()=>b.show,c=>{c&&b.serviceName?L():(z.value=null,S.value={})}),Pe(()=>{b.show&&b.serviceName&&L()}),(c,r)=>(n(),f(le,{show:U.show,title:z.value?`Configure ${z.value.label}`:"Configure Service",maxWidth:"max-w-lg",onClose:r[1]||(r[1]=p=>c.$emit("close"))},{default:m(()=>[s("div",Vt,[F.value?(n(),i("div",At,[o(a(V),{class:"w-8 h-8 mx-auto text-zinc-600 animate-spin mb-3"}),r[2]||(r[2]=s("p",{class:"text-zinc-500"},"Loading configuration...",-1))])):!z.value&&!A.value?(n(),i("div",Tt,[o(a(ut),{class:"w-8 h-8 mx-auto text-red-500/50 mb-3"}),r[3]||(r[3]=s("p",{class:"text-zinc-500"},"Failed to load service information.",-1))])):A.value?(n(),i("div",Ut,[o(ct,{"environment-id":U.environmentId},null,8,["environment-id"])])):(n(),i("form",{key:3,onSubmit:Me(W,["prevent"]),class:"space-y-6"},[(n(!0),i(P,null,Y(z.value?.configSchema??{},(p,y)=>(n(),i("div",{key:y,class:"space-y-1.5"},[s("label",{for:y,class:"block text-sm font-medium text-zinc-300"},[C(k(p.label)+" ",1),p.secret?(n(),i("span",Et,"Secret")):$("",!0)],8,Ft),p.enum?(n(),i("div",Lt,[ke(s("select",{id:y,"onUpdate:modelValue":_=>S.value[y]=_,class:"w-full bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-lime-500/50 focus:border-lime-500 transition-all appearance-none"},[(n(!0),i(P,null,Y(p.enum,_=>(n(),i("option",{key:_,value:_},k(_),9,Nt))),128))],8,Rt),[[Ge,S.value[y]]]),r[4]||(r[4]=s("div",{class:"absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none text-zinc-500"},[s("svg",{class:"w-4 h-4 fill-current",viewBox:"0 0 20 20"},[s("path",{d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd","fill-rule":"evenodd"})])],-1))])):p.type==="boolean"?(n(),i("div",Ht,[o(a(at),{checked:S.value[y],"onUpdate:checked":_=>S.value[y]=_},null,8,["checked","onUpdate:checked"]),s("span",Ot,k(S.value[y]?"Enabled":"Disabled"),1)])):(n(),i("div",qt,[ke(s("input",{id:y,type:p.secret&&!M.value[y]?"password":p.type==="integer"?"number":"text","onUpdate:modelValue":_=>S.value[y]=_,class:"w-full bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-white placeholder-zinc-600 focus:outline-none focus:ring-2 focus:ring-lime-500/50 focus:border-lime-500 transition-all",placeholder:p.default?.toString()},null,8,It),[[Ze,S.value[y]]]),p.secret?(n(),i("button",{key:0,type:"button",onClick:_=>v(y),class:"absolute inset-y-0 right-0 px-3 flex items-center text-zinc-500 hover:text-zinc-300"},[M.value[y]?(n(),f(a(mt),{key:0,class:"w-4 h-4"})):(n(),f(a(dt),{key:1,class:"w-4 h-4"}))],8,Dt)):$("",!0)])),p.description?(n(),i("p",Wt,k(p.description),1)):$("",!0)]))),128)),s("div",Bt,[o(a(j),{type:"button",onClick:r[0]||(r[0]=p=>c.$emit("close")),variant:"outline"},{default:m(()=>[...r[5]||(r[5]=[C(" Cancel ",-1)])]),_:1}),o(a(j),{type:"submit",disabled:T.value,variant:"secondary",class:"min-w-[100px] justify-center"},{default:m(()=>[T.value?(n(),f(a(V),{key:0,class:"w-4 h-4 animate-spin mr-2"})):(n(),f(a(ht),{key:1,class:"w-4 h-4 mr-2"})),r[6]||(r[6]=C(" Save Changes ",-1))]),_:1},8,["disabled"])])],32))])]),_:1},8,["show","title"]))}}),Qt={class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between mb-8"},Jt={class:"text-sm text-zinc-500 mt-1"},Yt={class:"flex items-center gap-2"},Gt={key:0,class:"rounded-lg border border-zinc-800 bg-zinc-900/50 p-8 text-center"},Zt={key:1,class:"space-y-6"},Kt={key:0,class:"rounded-lg border border-zinc-800 bg-zinc-900/50 overflow-hidden"},es={class:"px-4 py-3 border-b border-zinc-800 bg-zinc-800/30"},ts={class:"flex items-center justify-between"},ss={class:"text-sm font-medium text-zinc-100"},ns={class:"divide-y divide-zinc-800/50"},as={class:"flex h-9 w-9 shrink-0 items-center justify-center rounded-md bg-zinc-800/50 border border-zinc-700/50"},ls={class:"flex-1 min-w-0"},os={class:"flex items-center gap-2 flex-wrap"},is={class:"font-medium text-sm text-zinc-100"},rs={key:0,class:"px-2 py-0.5 text-[10px] font-medium uppercase tracking-wide rounded-full bg-zinc-800/80 text-zinc-400 ring-1 ring-inset ring-zinc-700/50"},cs={class:"text-xs text-zinc-500 mt-0.5 truncate"},us={key:0,class:"text-zinc-600/70"},ds={key:1,class:"text-zinc-500/70"},vs={class:"flex items-center gap-2"},ps={class:"flex items-center gap-0.5 opacity-40 hover:opacity-100 transition-opacity"},ms={key:0,class:"px-4 py-3 bg-red-500/5"},fs={class:"text-xs text-red-400 bg-red-400/10 border border-red-400/20 rounded px-3 py-2 flex items-center justify-between"},hs=["onClick"],gs={class:"flex flex-col h-[70vh] overflow-hidden"},bs={class:"flex items-center gap-3 px-4 py-3 border-b border-zinc-800 bg-zinc-900/50 shrink-0"},ys={class:"flex-1 overflow-auto bg-black"},xs={class:"text-xs text-zinc-300 font-mono whitespace-pre-wrap break-all p-4 m-0"},ws={class:"p-6"},ks={key:0,class:"py-8 text-center"},zs={class:"grid grid-cols-2 gap-4"},Ss={class:"grid grid-cols-2 gap-4"},_s={class:"flex justify-end gap-3 pt-4 border-t border-zinc-800"},Ls=be({__name:"Services",props:{environment:{},remoteApiUrl:{},editor:{},localPhpIniPath:{},homebrewPrefix:{}},setup(U){const I=U,b=nt(),D=Ke(),F=H(()=>!!b.props.reverb?.enabled),T=d(!1);ye(D,t=>{F.value&&t==="failed"&&!T.value&&(T.value=!0,w.warning("Real-time updates unavailable",{description:"Could not connect to Reverb. Status updates may be delayed."}))});const z=t=>I.remoteApiUrl?`${I.remoteApiUrl}${t}`:`/api/environments/${I.environment.id}${t}`,S=H(()=>z("")),M=document.querySelector('meta[name="csrf-token"]')?.content||"",A=d({}),L=d({}),W=d({}),v=d(!0),c=d(!1),r=d(null),p=H(()=>Object.values(A.value).filter(t=>t.status==="running").length),y=H(()=>Object.keys(A.value).length),_=d(!1),oe=d(!1),xe=d(null),ie=d(!1),O=d(null),B=d(""),Z=d(!1),G=d(!1),X=d(null);let R=null;const K=d(!1),re=d(!1),ee=d(!1),ce=d(""),x=d({upload_max_filesize:"2M",post_max_size:"8M",memory_limit:"128M",max_execution_time:"30",max_children:"5",start_servers:"2",min_spare_servers:"1",max_spare_servers:"3"}),ue={dns:{name:"DNS Server",description:"Resolves local domains to Orbit",icon:je,ports:"53",category:"core",required:!0},caddy:{name:"Caddy Web Server",description:"HTTPS reverse proxy with automatic certificates",icon:he,ports:"80, 443",category:"core",required:!0},postgres:{name:"PostgreSQL",description:"Relational database server",icon:ae,ports:"5432",category:"database"},mysql:{name:"MySQL",description:"Relational database server",icon:ae,ports:"3306",category:"database"},redis:{name:"Redis",description:"In-memory cache and message broker",icon:ae,ports:"6379",category:"database",required:!0},mailpit:{name:"Mailpit",description:"Email testing and capture",icon:Ve,ports:"1025, 8025",category:"utility"},reverb:{name:"Laravel Reverb",description:"WebSocket server for real-time features",icon:gt,ports:"8080",category:"utility",required:!0},horizon:{name:"Laravel Horizon",description:"Queue worker for production (orbit.ccc)",icon:fe,category:"utility",required:!0},"horizon-dev":{name:"Laravel Horizon",description:"Queue worker for development (orbit-web.ccc)",icon:fe,category:"utility",required:!0}};function te(t){return t==="caddy"||t.startsWith("php-")||t==="horizon"||t==="horizon-dev"?"host":"docker"}function Ae(t){if(ue[t])return ue[t];if(t.startsWith("php-")){const e=t.replace("php-","");let l=e;return e.length===2&&!e.includes(".")&&(l=`${e.slice(0,1)}.${e.slice(1)}`),{name:`PHP ${l}`,description:"Native PHP-FPM service",icon:ge,category:"php"}}return{name:t,description:"Service",icon:ge,category:"utility"}}const Te=[{key:"core",label:"Core Services"},{key:"php",label:"PHP Servers"},{key:"database",label:"Databases"},{key:"utility",label:"Utilities"}],se=H(()=>{const t={core:[],php:[],database:[],utility:[]};for(const[e,l]of Object.entries(A.value)){const u=Ae(e);t[u.category].push({key:e,service:l,meta:u})}return t.php.sort((e,l)=>e.key.localeCompare(l.key)),t}),Ue=H(()=>p.value===0);function Fe(t){if(!t.startsWith("php-"))return null;const e=t.replace("php-","");return e.includes(".")?e:e.length===2?`${e.slice(0,1)}.${e.slice(1)}`:null}const Ee=H(()=>{const t=se.value.php.map(({key:e})=>Fe(e)).filter(e=>e!==null);return t.length===0?null:(t.sort((e,l)=>{const[u,g]=e.split(".").map(Number),[h,N]=l.split(".").map(Number);return u!==h?u-h:g-N}),t[t.length-1])});function Q(t){return Object.values(L.value).some(e=>e.service===t)}function we(t){return W.value[t]}function Le(t){delete W.value[t]}async function Re(){const t=Ee.value;if(!t){w.error("No PHP services detected");return}ce.value=t,re.value=!0,K.value=!0;try{const e=await fetch(z(`/php/config/${t}`));if(!e.ok)throw new Error("Failed to fetch PHP settings");const l=await e.json();l.success&&l.data?.settings&&(x.value={...x.value,...l.data.settings})}catch(e){w.error(`Error loading PHP settings: ${e}`)}finally{re.value=!1}}async function Ne(){ee.value=!0;try{const t=await fetch(z(`/php/config/${ce.value}`),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(x.value)});if(!t.ok)throw new Error("Failed to save PHP settings");const e=await t.json();e.success?(w.success("PHP Settings Saved",{description:"PHP-FPM has been restarted with the new configuration."}),K.value=!1):w.error("Failed to Save Settings",{description:e.error||"An unknown error occurred."})}catch(t){w.error("Error Saving PHP Settings",{description:String(t)})}finally{ee.value=!1}}async function J(t=!1){t||(v.value=!0);try{const e=await fetch(`${S.value}/status`);if(!e.ok){console.error("Failed to fetch services:",e.status,e.statusText);return}const l=await e.json();console.log("Services API response:",l),l.success&&l.data?.services?A.value=l.data.services:l.services&&(A.value=l.services)}catch(e){console.error("Failed to fetch services:",e)}finally{t||(v.value=!1)}}async function He(){r.value="stop-all";try{const e=await(await fetch(`${S.value}/stop`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":M}})).json();e.success?(w.success("Services Stopping",{description:"All services are being stopped."}),await J(!0)):w.error("Failed to Stop Services",{description:e.error||"An unknown error occurred."})}catch{w.error("Failed to Stop Services",{description:"Could not connect to the server."})}finally{r.value=null}}async function Oe(){c.value=!0,r.value="restart-all";try{const e=await(await fetch(`${S.value}/restart`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":M}})).json();e.success?(w.success("Services Restarting",{description:"All services are being restarted."}),await J(!0)):w.error("Failed to Restart Services",{description:e.error||"An unknown error occurred."})}catch{w.error("Failed to Restart Services",{description:"Could not connect to the server."})}finally{c.value=!1,r.value=null}}async function de(t,e){const u=te(t)==="host"?"host-services":"services";try{const h=await(await fetch(`${S.value}/${u}/${t}/${e}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":M}})).json();h.jobId&&(L.value[h.jobId]={service:t,action:e,startedAt:Date.now()}),h?.success?h.jobId||await J(!0):w.error(`Failed to ${e} ${t}: `+(h?.error||"Unknown error"))}catch{w.error(`Failed to ${e} ${t}`)}}async function qe(t){if(confirm(`Are you sure you want to remove ${t}?`))try{const l=await(await fetch(`${S.value}/services/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":M}})).json();l?.success?(w.success(`${t} disabled`),await J(!0)):w.error("Failed to remove service: "+(l?.error||"Unknown error"))}catch{w.error("Failed to remove service")}}function Ie(t){xe.value=t,oe.value=!0}async function De(t){O.value=t,ie.value=!0,await ve()}function We(t){return t.replace(/(\d{4}-\d{2}-\d{2})T(\d{2}):(\d{2}):\d{2}\.\d+Z/g,(e,l,u,g)=>`${l} ${u}:${g}`)}async function ve(){if(O.value){Z.value=!0;try{const e=te(O.value)==="host"?`/host-services/${O.value}/logs`:`/services/${O.value}/logs`;let l=e;if(X.value){const h=X.value.toISOString();l=`${e}?since=${encodeURIComponent(h)}`}const g=await(await fetch(z(l))).json();if(g.success){const h=We(g.logs||"No logs available");if(X.value){const N=X.value.toLocaleTimeString();B.value=`--- Logs cleared at ${N} (showing only new entries) ---

${h}`}else B.value=h}else B.value="Failed to fetch logs: "+(g.error||"Unknown error")}catch{B.value="Failed to fetch logs"}finally{Z.value=!1}}}function Be(){ie.value=!1,O.value=null,B.value="",G.value=!1,X.value=null,R&&(clearInterval(R),R=null)}function Xe(){X.value=new Date,B.value=`--- Logs cleared at ${X.value.toLocaleTimeString()} ---

Waiting for new log entries...`}function Qe(){G.value=!G.value,G.value?R=setInterval(ve,3e3):R&&(clearInterval(R),R=null)}function Je(t){return t.icon}function Ye(t,e,l,u){t&&L.value[t]&&(u&&(W.value[e]=u),delete L.value[t]),A.value[e]&&(A.value[e].status=l)}return F.value&&et("orbit",".service.status.changed",t=>{Ye(t.job_id,t.service,t.status,t.error),t.error?w.error(`Failed to ${t.action} ${t.service}: ${t.error}`):w.success(`${t.service} ${t.action} completed`)}),Pe(async()=>{await J()}),tt(()=>{R&&clearInterval(R)}),(t,e)=>(n(),i(P,null,[o(a(st),{title:`Services - ${U.environment.name}`},null,8,["title"]),s("div",null,[s("header",Qt,[s("div",null,[e[15]||(e[15]=s("h1",{class:"text-2xl font-semibold tracking-tight text-zinc-100"},"Services",-1)),s("p",Jt,[v.value?(n(),i(P,{key:0},[C("Loading services...")],64)):(n(),i(P,{key:1},[C(k(p.value)+"/"+k(y.value)+" services running",1)],64))])]),s("div",Yt,[o(a(j),{onClick:e[0]||(e[0]=l=>_.value=!0),disabled:v.value,size:"sm",class:"bg-lime-500 hover:bg-lime-600 text-zinc-950"},{default:m(()=>[o(a(Ce),{class:"w-4 h-4 mr-1.5"}),e[16]||(e[16]=C(" Add Service ",-1))]),_:1},8,["disabled"]),Ue.value?$("",!0):(n(),f(a(j),{key:0,onClick:He,disabled:v.value||r.value!==null,variant:"secondary",size:"sm"},{default:m(()=>[r.value==="stop-all"?(n(),f(a(V),{key:0,class:"w-3.5 h-3.5 mr-1.5 animate-spin"})):(n(),f(a(_e),{key:1,class:"w-3.5 h-3.5 mr-1.5"})),e[17]||(e[17]=C(" Stop All ",-1))]),_:1},8,["disabled"])),o(a(j),{onClick:Oe,disabled:v.value||r.value!==null,variant:"secondary",size:"sm"},{default:m(()=>[c.value?(n(),f(a(V),{key:0,class:"w-3.5 h-3.5 mr-1.5 animate-spin"})):(n(),f(a(me),{key:1,class:"w-3.5 h-3.5 mr-1.5"})),e[18]||(e[18]=C(" Restart All ",-1))]),_:1},8,["disabled"])])]),v.value?(n(),i("div",Gt,[o(a(V),{class:"w-8 h-8 mx-auto text-zinc-600 animate-spin mb-3"}),e[19]||(e[19]=s("p",{class:"text-zinc-500"},"Loading services...",-1))])):(n(),i("div",Zt,[(n(),i(P,null,Y(Te,l=>(n(),i(P,{key:l.key},[se.value[l.key].length>0?(n(),i("div",Kt,[s("div",es,[s("div",ts,[s("h2",ss,k(l.label),1),l.key==="php"?(n(),f(a(j),{key:0,onClick:Re,variant:"ghost",size:"icon-sm",class:"h-7 w-7 text-zinc-400 hover:text-zinc-100",title:"PHP Settings"},{default:m(()=>[o(a(ze),{class:"w-4 h-4"})]),_:1})):$("",!0)])]),s("div",ns,[(n(!0),i(P,null,Y(se.value[l.key],({key:u,service:g,meta:h})=>(n(),i("div",{key:u,class:"flex items-center gap-4 px-4 py-3 transition-colors hover:bg-zinc-800/30"},[s("div",as,[(n(),f($e(Je(h)),{class:"h-4 w-4 text-zinc-400"}))]),s("div",ls,[s("div",os,[s("span",is,k(h.name),1),g.required||h.required?(n(),i("span",rs," Required ")):$("",!0),s("span",{class:ne(["px-2 py-0.5 text-[10px] font-medium uppercase tracking-wide rounded-full ring-1 ring-inset",te(u)==="docker"?"bg-blue-500/10 text-blue-400 ring-blue-500/20":"bg-lime-500/10 text-lime-400 ring-lime-500/20"])},k(te(u)),3),s("span",{class:ne(["h-2 w-2 rounded-full",g.status==="running"?"bg-lime-400":g.status==="stopped"?"bg-zinc-600":"bg-red-400"])},null,2)]),s("p",cs,[C(k(h.description)+" ",1),h.ports?(n(),i("span",us," Â· ")):$("",!0),h.ports?(n(),i("span",ds,k(h.ports),1)):$("",!0)])]),s("div",vs,[s("span",{class:ne(["px-2.5 py-1 text-xs font-medium rounded-full ring-1 ring-inset",g.status==="running"?"bg-lime-500/15 text-lime-400 ring-lime-500/30":g.status==="stopped"?"bg-zinc-800 text-zinc-400 ring-zinc-700":"bg-red-500/15 text-red-400 ring-red-500/30"])},k(g.status==="running"?"Running":g.status==="stopped"?"Stopped":"Error"),3),s("div",ps,[g.status!=="running"?(n(),f(a(j),{key:0,onClick:N=>de(u,"start"),disabled:Q(u),variant:"ghost",size:"icon-sm",class:"h-8 w-8 text-zinc-400 hover:text-lime-400 hover:bg-zinc-800",title:"Start"},{default:m(()=>[Q(u)?(n(),f(a(V),{key:0,class:"w-3.5 h-3.5 animate-spin"})):(n(),f(a(ft),{key:1,class:"w-3.5 h-3.5"}))]),_:2},1032,["onClick","disabled"])):$("",!0),g.status==="running"?(n(),f(a(j),{key:1,onClick:N=>de(u,"stop"),disabled:Q(u),variant:"ghost",size:"icon-sm",class:"h-8 w-8 text-zinc-400 hover:text-red-400 hover:bg-zinc-800",title:"Stop"},{default:m(()=>[Q(u)?(n(),f(a(V),{key:0,class:"w-3.5 h-3.5 animate-spin"})):(n(),f(a(_e),{key:1,class:"w-3.5 h-3.5"}))]),_:2},1032,["onClick","disabled"])):$("",!0),o(a(j),{onClick:N=>de(u,"restart"),disabled:Q(u),variant:"ghost",size:"icon-sm",class:"h-8 w-8 text-zinc-400 hover:text-zinc-100 hover:bg-zinc-800",title:"Restart"},{default:m(()=>[Q(u)?(n(),f(a(V),{key:0,class:"w-3.5 h-3.5 animate-spin"})):(n(),f(a(me),{key:1,class:"w-3.5 h-3.5"}))]),_:2},1032,["onClick","disabled"]),o(a(rt),null,{default:m(()=>[o(a(lt),{"as-child":""},{default:m(()=>[o(a(j),{variant:"ghost",size:"icon-sm",class:"h-8 w-8 text-zinc-400 hover:text-zinc-100 hover:bg-zinc-800"},{default:m(()=>[o(a(pt),{class:"w-4 h-4"})]),_:1})]),_:1}),o(a(ot),{align:"end",class:"w-40"},{default:m(()=>[o(a(pe),{onClick:N=>Ie(u)},{default:m(()=>[o(a(ze),{class:"w-4 h-4 mr-2"}),e[20]||(e[20]=C(" Settings ",-1))]),_:1},8,["onClick"]),o(a(pe),{onClick:N=>De(u)},{default:m(()=>[o(a(fe),{class:"w-4 h-4 mr-2"}),e[21]||(e[21]=C(" View Logs ",-1))]),_:1},8,["onClick"]),!g.required&&!h.required?(n(),i(P,{key:0},[o(a(it)),o(a(pe),{onClick:N=>qe(u),disabled:Q(u),class:"text-red-400 focus:text-red-400"},{default:m(()=>[o(a(Se),{class:"w-4 h-4 mr-2"}),e[22]||(e[22]=C(" Remove ",-1))]),_:1},8,["onClick","disabled"])],64)):$("",!0)]),_:2},1024)]),_:2},1024)])])]))),128)),(n(!0),i(P,null,Y(se.value[l.key],({key:u})=>(n(),i(P,{key:`error-${u}`},[we(u)?(n(),i("div",ms,[s("div",fs,[s("span",null,"Error: "+k(we(u)),1),s("button",{onClick:g=>Le(u),class:"text-red-400 hover:text-white ml-2"},[o(a(vt),{class:"w-3 h-3"})],8,hs)])])):$("",!0)],64))),128))])])):$("",!0)],64))),64))])),o(jt,{show:_.value,"get-api-url":z,"csrf-token":a(M),onClose:e[1]||(e[1]=l=>_.value=!1),onServiceEnabled:e[2]||(e[2]=()=>J())},null,8,["show","csrf-token"]),o(Xt,{show:oe.value,"service-name":xe.value,"environment-id":U.environment.id,"get-api-url":z,"csrf-token":a(M),onClose:e[3]||(e[3]=l=>oe.value=!1),onConfigUpdated:e[4]||(e[4]=()=>J())},null,8,["show","service-name","environment-id","csrf-token"]),o(le,{show:ie.value,title:`${ue[O.value]?.name||O.value} Logs`,maxWidth:"max-w-4xl",noPadding:"",onClose:Be},{default:m(()=>[s("div",gs,[s("div",bs,[o(a(j),{onClick:ve,disabled:Z.value,variant:"ghost",size:"icon-sm",title:"Refresh"},{default:m(()=>[Z.value?(n(),f(a(V),{key:0,class:"w-4 h-4 animate-spin"})):(n(),f(a(me),{key:1,class:"w-4 h-4"}))]),_:1},8,["disabled"]),o(a(j),{onClick:Xe,disabled:Z.value,variant:"ghost",size:"icon-sm",title:"Clear logs display"},{default:m(()=>[o(a(Se),{class:"w-4 h-4"})]),_:1},8,["disabled"]),s("button",{onClick:Qe,class:ne(["text-xs px-2 py-1 rounded-full",G.value?"bg-lime-500/10 text-lime-400":"bg-zinc-700/50 text-zinc-400 hover:text-white"])},k(G.value?"Auto-refresh ON":"Auto-refresh"),3)]),s("div",ys,[s("pre",xs,k(B.value),1)])])]),_:1},8,["show","title"]),o(le,{show:K.value,title:`PHP ${ce.value} Settings`,maxWidth:"max-w-lg",onClose:e[14]||(e[14]=l=>K.value=!1)},{default:m(()=>[s("div",ws,[re.value?(n(),i("div",ks,[o(a(V),{class:"w-8 h-8 mx-auto text-zinc-600 animate-spin mb-3"}),e[23]||(e[23]=s("p",{class:"text-zinc-500"},"Loading settings...",-1))])):(n(),i("form",{key:1,onSubmit:Me(Ne,["prevent"]),class:"space-y-6"},[s("div",null,[e[28]||(e[28]=s("h4",{class:"text-sm font-medium text-white mb-3"},"php.ini",-1)),s("div",zs,[s("div",null,[e[24]||(e[24]=s("label",{class:"block text-xs text-zinc-400 mb-1"},"Upload Max Filesize",-1)),o(a(q),{modelValue:x.value.upload_max_filesize,"onUpdate:modelValue":e[5]||(e[5]=l=>x.value.upload_max_filesize=l),class:"w-full font-mono"},null,8,["modelValue"])]),s("div",null,[e[25]||(e[25]=s("label",{class:"block text-xs text-zinc-400 mb-1"},"Post Max Size",-1)),o(a(q),{modelValue:x.value.post_max_size,"onUpdate:modelValue":e[6]||(e[6]=l=>x.value.post_max_size=l),class:"w-full font-mono"},null,8,["modelValue"])]),s("div",null,[e[26]||(e[26]=s("label",{class:"block text-xs text-zinc-400 mb-1"},"Memory Limit",-1)),o(a(q),{modelValue:x.value.memory_limit,"onUpdate:modelValue":e[7]||(e[7]=l=>x.value.memory_limit=l),class:"w-full font-mono"},null,8,["modelValue"])]),s("div",null,[e[27]||(e[27]=s("label",{class:"block text-xs text-zinc-400 mb-1"},"Max Execution Time (sec)",-1)),o(a(q),{modelValue:x.value.max_execution_time,"onUpdate:modelValue":e[8]||(e[8]=l=>x.value.max_execution_time=l),class:"w-full font-mono"},null,8,["modelValue"])])])]),s("div",null,[e[33]||(e[33]=s("h4",{class:"text-sm font-medium text-white mb-3"},"PHP-FPM Pool",-1)),s("div",Ss,[s("div",null,[e[29]||(e[29]=s("label",{class:"block text-xs text-zinc-400 mb-1"},"Max Children",-1)),o(a(q),{modelValue:x.value.max_children,"onUpdate:modelValue":e[9]||(e[9]=l=>x.value.max_children=l),type:"number",class:"w-full font-mono"},null,8,["modelValue"])]),s("div",null,[e[30]||(e[30]=s("label",{class:"block text-xs text-zinc-400 mb-1"},"Start Servers",-1)),o(a(q),{modelValue:x.value.start_servers,"onUpdate:modelValue":e[10]||(e[10]=l=>x.value.start_servers=l),type:"number",class:"w-full font-mono"},null,8,["modelValue"])]),s("div",null,[e[31]||(e[31]=s("label",{class:"block text-xs text-zinc-400 mb-1"},"Min Spare Servers",-1)),o(a(q),{modelValue:x.value.min_spare_servers,"onUpdate:modelValue":e[11]||(e[11]=l=>x.value.min_spare_servers=l),type:"number",class:"w-full font-mono"},null,8,["modelValue"])]),s("div",null,[e[32]||(e[32]=s("label",{class:"block text-xs text-zinc-400 mb-1"},"Max Spare Servers",-1)),o(a(q),{modelValue:x.value.max_spare_servers,"onUpdate:modelValue":e[12]||(e[12]=l=>x.value.max_spare_servers=l),type:"number",class:"w-full font-mono"},null,8,["modelValue"])])])]),s("div",_s,[o(a(j),{type:"button",variant:"ghost",onClick:e[13]||(e[13]=l=>K.value=!1)},{default:m(()=>[...e[34]||(e[34]=[C(" Cancel ",-1)])]),_:1}),o(a(j),{type:"submit",variant:"secondary",disabled:ee.value},{default:m(()=>[ee.value?(n(),f(a(V),{key:0,class:"w-4 h-4 animate-spin"})):$("",!0),C(" "+k(ee.value?"Saving...":"Save Settings"),1)]),_:1},8,["disabled"])])],32))])]),_:1},8,["show","title"])])],64))}});export{Ls as default};
