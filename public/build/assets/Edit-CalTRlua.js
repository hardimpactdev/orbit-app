import{d as I,k as O,m as z,a as m,h as r,u as t,i as B,b as o,w as i,G as H,e as a,l as S,p as P,t as p,g as v,A as _,J as k,B as T,F as $,r as h,q as y,o as c}from"./app-CY_syUay.js";import{_ as q}from"./Heading.vue_vue_type_script_setup_true_lang-sR81lrti.js";import{X as u,Y as x,I as C}from"./craft-ui-EQePVbv_.js";import{T as A}from"./triangle-alert-DRt9sjZt.js";const R={class:"mb-6"},J={class:"space-y-6"},M={key:0,class:"mt-2 text-sm text-red-400"},X={class:"flex items-center"},Y={class:"flex items-center"},G={class:"pl-6"},K={class:"space-y-6"},Q={class:"grid grid-cols-2 gap-4"},W={key:0,class:"mt-2 text-sm text-red-400"},Z={key:0,class:"mt-2 text-sm text-red-400"},ee={key:0,class:"mt-2 text-sm text-red-400"},te={class:"pt-6 border-t border-border"},se={class:"flex items-center"},oe={class:"mt-2 text-sm text-muted-foreground"},re={class:"font-mono text-foreground"},ne={key:0,class:"mt-2 text-sm text-muted-foreground"},le={key:1,class:"mt-2 text-sm text-amber-400 flex items-center"},ae={class:"mt-8 flex gap-3"},fe=I({__name:"Edit",props:{environment:{}},setup(U){const d=U,s=O({name:d.environment.name,host:d.environment.host,user:d.environment.user,port:d.environment.port,is_local:d.environment.is_local,external_access:d.environment.external_access,external_host:d.environment.external_host??""}),f=h(""),b=h(!0),g=h(null),w=h({}),V=y(()=>f.value||"test"),E=y(()=>{const l=f.value||"test";return Object.entries(w.value).filter(([e,n])=>n===l&&parseInt(e)!==d.environment.id).map(([e])=>parseInt(e))}),N=y(()=>E.value.length>0),D=async()=>{try{const e=await(await fetch(`/environments/${d.environment.id}/config`)).json();e.success&&e.data&&(g.value=e.data,f.value=e.data.tld||"test")}catch(l){console.error("Failed to load config:",l)}finally{b.value=!1}},L=async()=>{try{const e=await(await fetch("/api/environments/tlds")).json();e.success&&(w.value=e.data||{})}catch(l){console.error("Failed to load other server TLDs:",l)}},j=async()=>{const l=f.value.trim()||"test";if(!g.value)return{success:!1,error:"Config not loaded"};try{const e=await fetch(`/environments/${d.environment.id}/config`,{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.content||"","Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({paths:g.value.paths||[],tld:l,default_php_version:g.value.default_php_version||"8.4"})});if(!e.ok){const n=await e.text();try{return{success:!1,error:JSON.parse(n).message||"Request failed"}}catch{return{success:!1,error:`Server error: ${e.status}`}}}return await e.json()}catch(e){return{success:!1,error:e.message}}},F=async()=>{const l=await j();if(!l.success){alert("Failed to save TLD configuration: "+(l.error||"Unknown error"));return}s.put(`/environments/${d.environment.id}`)};return z(()=>{D(),L()}),(l,e)=>(c(),m($,null,[r(t(B),{title:"Edit Environment"}),o("div",null,[o("div",R,[r(t(S),{href:"/servers",class:"text-zinc-400 hover:text-white flex items-center transition-colors text-sm"},{default:i(()=>[r(t(H),{class:"w-4 h-4 mr-1"}),e[8]||(e[8]=a(" Back to Environments ",-1))]),_:1})]),r(q,{title:"Edit Environment"}),o("form",{onSubmit:P(F,["prevent"]),class:"mt-8 max-w-lg"},[o("div",J,[o("div",null,[r(t(u),{for:"name",class:"text-muted-foreground mb-2"},{default:i(()=>[...e[9]||(e[9]=[a("Name",-1)])]),_:1}),r(t(x),{modelValue:t(s).name,"onUpdate:modelValue":e[0]||(e[0]=n=>t(s).name=n),type:"text",id:"name",required:"",class:"w-full"},null,8,["modelValue"]),t(s).errors.name?(c(),m("p",M,p(t(s).errors.name),1)):v("",!0)]),o("div",X,[_(o("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>t(s).is_local=n),type:"checkbox",id:"is_local",class:"w-4 h-4 rounded border-zinc-600 bg-zinc-800 text-lime-400 focus:ring-lime-400/20 focus:ring-offset-0"},null,512),[[k,t(s).is_local]]),r(t(u),{for:"is_local",class:"ml-2 text-muted-foreground"},{default:i(()=>[...e[10]||(e[10]=[a(" This is a local environment ",-1)])]),_:1})]),o("div",Y,[_(o("input",{"onUpdate:modelValue":e[2]||(e[2]=n=>t(s).external_access=n),type:"checkbox",id:"external_access",class:"w-4 h-4 rounded border-zinc-600 bg-zinc-800 text-lime-400 focus:ring-lime-400/20 focus:ring-offset-0"},null,512),[[k,t(s).external_access]]),r(t(u),{for:"external_access",class:"ml-2 text-muted-foreground"},{default:i(()=>[...e[11]||(e[11]=[a(" External access (use SSH URLs for editor links) ",-1)])]),_:1})]),_(o("div",G,[r(t(u),{for:"external_host",class:"text-muted-foreground mb-2"},{default:i(()=>[...e[12]||(e[12]=[a(" External Host / IP ",-1)])]),_:1}),r(t(x),{modelValue:t(s).external_host,"onUpdate:modelValue":e[3]||(e[3]=n=>t(s).external_host=n),type:"text",id:"external_host",placeholder:"e.g. 192.168.1.100 or myserver.example.com",class:"w-full"},null,8,["modelValue"]),e[13]||(e[13]=o("p",{class:"mt-1 text-xs text-muted-foreground"}," The hostname or IP address external users will use to connect via SSH ",-1))],512),[[T,t(s).external_access]]),_(o("div",K,[o("div",Q,[o("div",null,[r(t(u),{for:"host",class:"text-muted-foreground mb-2"},{default:i(()=>[...e[14]||(e[14]=[a("Host",-1)])]),_:1}),r(t(x),{modelValue:t(s).host,"onUpdate:modelValue":e[4]||(e[4]=n=>t(s).host=n),type:"text",id:"host",class:"w-full"},null,8,["modelValue"]),t(s).errors.host?(c(),m("p",W,p(t(s).errors.host),1)):v("",!0)]),o("div",null,[r(t(u),{for:"port",class:"text-muted-foreground mb-2"},{default:i(()=>[...e[15]||(e[15]=[a("Port",-1)])]),_:1}),r(t(x),{modelValue:t(s).port,"onUpdate:modelValue":e[5]||(e[5]=n=>t(s).port=n),type:"number",id:"port",class:"w-full"},null,8,["modelValue"]),t(s).errors.port?(c(),m("p",Z,p(t(s).errors.port),1)):v("",!0)])]),o("div",null,[r(t(u),{for:"user",class:"text-muted-foreground mb-2"},{default:i(()=>[...e[16]||(e[16]=[a("SSH User",-1)])]),_:1}),r(t(x),{modelValue:t(s).user,"onUpdate:modelValue":e[6]||(e[6]=n=>t(s).user=n),type:"text",id:"user",class:"w-full"},null,8,["modelValue"]),t(s).errors.user?(c(),m("p",ee,p(t(s).errors.user),1)):v("",!0)])],512),[[T,!t(s).is_local]]),o("div",te,[e[20]||(e[20]=o("h3",{class:"text-sm font-medium text-foreground mb-4"},"DNS Configuration",-1)),o("div",null,[r(t(u),{for:"tld",class:"text-muted-foreground mb-2"},{default:i(()=>[...e[17]||(e[17]=[a(" TLD (Top-Level Domain) ",-1)])]),_:1}),o("div",se,[e[18]||(e[18]=o("span",{class:"text-muted-foreground mr-1"},".",-1)),r(t(x),{modelValue:f.value,"onUpdate:modelValue":e[7]||(e[7]=n=>f.value=n),type:"text",id:"tld",placeholder:"test",class:"w-32 font-mono"},null,8,["modelValue"])]),o("p",oe,[e[19]||(e[19]=a(" Sites will be accessible at ",-1)),o("span",re,"sitename."+p(V.value),1)]),b.value?(c(),m("p",ne," Loading current TLD... ")):v("",!0),N.value?(c(),m("p",le,[r(t(A),{class:"w-4 h-4 mr-1"}),a(" Another environment is using ."+p(V.value)+" - this may cause DNS conflicts ",1)])):v("",!0)])])]),o("div",ae,[r(t(C),{type:"submit",disabled:t(s).processing,variant:"secondary"},{default:i(()=>[...e[21]||(e[21]=[a(" Save Changes ",-1)])]),_:1},8,["disabled"]),r(t(C),{"as-child":"",variant:"ghost"},{default:i(()=>[r(t(S),{href:"/servers"},{default:i(()=>[...e[22]||(e[22]=[a("Cancel",-1)])]),_:1})]),_:1})])],32)])],64))}});export{fe as default};
