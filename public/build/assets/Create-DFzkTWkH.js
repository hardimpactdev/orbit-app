import{d as $,r as _,k as O,D as U,a as r,h as a,u as t,i as M,b as s,w as c,G as X,e as u,l as K,n as j,g as d,p as F,t as m,o as l,f as b,S as Y,A as I,H as W,F as z,j as T,I as G,q as V,x as J}from"./app-CY_syUay.js";import{_ as Q}from"./Heading.vue_vue_type_script_setup_true_lang-sR81lrti.js";import{X as w,Y as C,I as y}from"./craft-ui-EQePVbv_.js";import{L as A}from"./loader-circle-D6enBMLd.js";import{C as q}from"./circle-check-big-DxcMNEmi.js";import{C as Z}from"./circle-alert-1Us8Q69i.js";const ee={class:"mb-6"},te={class:"mb-8"},se={class:"inline-flex rounded-lg bg-zinc-800 p-1"},oe=["disabled"],le={key:0,class:"ml-1 text-xs"},re={class:"space-y-6"},ne={key:0,class:"mt-2 text-sm text-red-400"},ae={class:"mt-8 flex gap-3"},ie={class:"space-y-6"},ue={key:0,class:"mt-2 text-sm text-red-400"},de={key:0,class:"mt-2 text-sm text-red-400"},me={key:0,class:"mt-2 text-sm text-red-400"},ce={key:0},ve={key:1,class:"p-4 bg-lime-400/10 border border-lime-400/20 rounded-lg"},pe={class:"flex items-start"},fe={class:"flex-1"},he={class:"mt-1 text-sm text-zinc-400"},be={key:0},ye={key:2,class:"p-4 bg-blue-400/10 border border-blue-400/20 rounded-lg"},xe={class:"flex items-start"},ke={class:"flex-1"},ge={class:"text-sm font-medium text-blue-400"},_e={key:3,class:"p-4 bg-red-400/10 border border-red-400/20 rounded-lg"},we={class:"flex items-start"},Se={class:"flex-1"},Ce={class:"mt-1 text-sm text-zinc-400"},Ke={key:4},ze={key:0,label:"Saved Keys"},Ve=["value"],Ae={key:1,label:"Import from ~/.ssh/"},Ee=["value"],Le={key:2,class:"mt-2 text-sm text-red-400"},Ne={key:0,class:"mt-8 p-4 bg-yellow-400/10 border border-yellow-400/20 rounded-lg"},Oe={class:"mt-8 flex gap-3"},Be=$({__name:"Create",props:{currentUser:{},sshKeys:{},availableSshKeys:{},hasLocalEnvironment:{type:Boolean}},setup(p){const f=p,x=_(f.hasLocalEnvironment?"remote":"local"),E=V(()=>f.sshKeys.find(e=>e.is_default)?.public_key||f.sshKeys[0]?.public_key||""),h=O({name:"Local",host:"localhost",user:f.currentUser,port:22,is_local:!0}),o=O({name:"",host:"",user:"root",ssh_public_key:E.value}),L=V(()=>f.sshKeys.length>0||Object.keys(f.availableSshKeys).length>0),S=_(E.value),B=V(()=>!L.value||S.value==="custom");U(S,v=>{v&&v!=="custom"?o.ssh_public_key=v:v==="custom"&&(o.ssh_public_key="")});const k=_(!1),i=_(null),g=_(!1);U([()=>o.host,()=>o.user],()=>{i.value=null,g.value=!1});const P=async()=>{if(o.host){k.value=!0,i.value=null;try{const v=await fetch("/provision/check-server",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({host:o.host,user:o.user})});i.value=await v.json(),g.value=!0}catch{i.value={has_orbit:!1,has_orbit_user:!1,orbit_running:!1,can_connect:!1,connected_as:null,error:"Failed to check server connection"},g.value=!0}finally{k.value=!1}}},D=()=>{J.post("/environments",{name:o.name,host:o.host,user:i.value?.connected_as==="orbit"?"orbit":o.user,port:22,is_local:!1})},H=()=>{h.post("/environments")},R=()=>{o.post("/provision")};return(v,e)=>(l(),r(z,null,[a(t(M),{title:"Add Environment"}),s("div",null,[s("div",ee,[a(t(K),{href:"/servers",class:"text-zinc-400 hover:text-white flex items-center transition-colors text-sm"},{default:c(()=>[a(t(X),{class:"w-4 h-4 mr-1"}),e[9]||(e[9]=u(" Back to Environments ",-1))]),_:1})]),a(Q,{title:"Add Environment"}),e[29]||(e[29]=s("p",{class:"text-zinc-400 mb-8 mt-2"}," Add a local or remote environment to manage development projects. ",-1)),s("div",te,[s("div",se,[s("button",{type:"button",onClick:e[0]||(e[0]=n=>x.value="local"),disabled:p.hasLocalEnvironment,class:j(["px-4 py-1.5 text-sm font-medium rounded-md transition-colors",x.value==="local"?"bg-zinc-600 text-white":p.hasLocalEnvironment?"text-zinc-600 cursor-not-allowed":"text-zinc-400 hover:text-white"])},[e[10]||(e[10]=u(" Local ",-1)),p.hasLocalEnvironment?(l(),r("span",le,"(configured)")):d("",!0)],10,oe),s("button",{type:"button",onClick:e[1]||(e[1]=n=>x.value="remote"),class:j(["px-4 py-1.5 text-sm font-medium rounded-md transition-colors",x.value==="remote"?"bg-zinc-600 text-white":"text-zinc-400 hover:text-white"])}," Remote ",2)])]),x.value==="local"?(l(),r("form",{key:0,onSubmit:F(H,["prevent"]),class:"max-w-lg"},[s("div",re,[s("div",null,[a(t(w),{for:"local-name",class:"text-muted-foreground mb-2"},{default:c(()=>[...e[11]||(e[11]=[u(" Environment Name ",-1)])]),_:1}),a(t(C),{modelValue:t(h).name,"onUpdate:modelValue":e[2]||(e[2]=n=>t(h).name=n),type:"text",id:"local-name",required:"",placeholder:"Local",class:"w-full"},null,8,["modelValue"]),t(h).errors.name?(l(),r("p",ne,m(t(h).errors.name),1)):d("",!0)])]),s("div",ae,[a(t(y),{type:"submit",disabled:t(h).processing,variant:"secondary"},{default:c(()=>[...e[12]||(e[12]=[u(" Add ",-1)])]),_:1},8,["disabled"]),a(t(y),{"as-child":"",variant:"ghost"},{default:c(()=>[a(t(K),{href:"/servers"},{default:c(()=>[...e[13]||(e[13]=[u(" Cancel ",-1)])]),_:1})]),_:1})])],32)):(l(),r("form",{key:1,onSubmit:F(R,["prevent"]),class:"max-w-lg"},[s("div",ie,[s("div",null,[a(t(w),{for:"remote-name",class:"text-muted-foreground mb-2"},{default:c(()=>[...e[14]||(e[14]=[u(" Environment Name ",-1)])]),_:1}),a(t(C),{modelValue:t(o).name,"onUpdate:modelValue":e[3]||(e[3]=n=>t(o).name=n),type:"text",id:"remote-name",required:"",placeholder:"Production",class:"w-full"},null,8,["modelValue"]),t(o).errors.name?(l(),r("p",ue,m(t(o).errors.name),1)):d("",!0)]),s("div",null,[a(t(w),{for:"host",class:"text-muted-foreground mb-2"},{default:c(()=>[...e[15]||(e[15]=[u(" Host IP Address ",-1)])]),_:1}),a(t(C),{modelValue:t(o).host,"onUpdate:modelValue":e[4]||(e[4]=n=>t(o).host=n),type:"text",id:"host",required:"",placeholder:"192.168.1.100",class:"w-full"},null,8,["modelValue"]),t(o).errors.host?(l(),r("p",de,m(t(o).errors.host),1)):d("",!0)]),s("div",null,[a(t(w),{for:"user",class:"text-muted-foreground mb-2"},{default:c(()=>[...e[16]||(e[16]=[u(" SSH User ",-1)])]),_:1}),a(t(C),{modelValue:t(o).user,"onUpdate:modelValue":e[5]||(e[5]=n=>t(o).user=n),type:"text",id:"user",required:"",placeholder:"root",class:"w-full"},null,8,["modelValue"]),e[17]||(e[17]=s("p",{class:"mt-2 text-sm text-muted-foreground"}," User must have sudo privileges for provisioning ",-1)),t(o).errors.user?(l(),r("p",me,m(t(o).errors.user),1)):d("",!0)]),t(o).host&&!g.value?(l(),r("div",ce,[a(t(y),{type:"button",onClick:P,disabled:k.value,variant:"outline",class:"w-full"},{default:c(()=>[k.value?(l(),b(t(A),{key:0,class:"w-4 h-4 animate-spin"})):(l(),b(t(Y),{key:1,class:"w-4 h-4"})),u(" "+m(k.value?"Checking server...":"Check Server"),1)]),_:1},8,["disabled"])])):d("",!0),i.value?.has_orbit?(l(),r("div",ve,[s("div",pe,[a(t(q),{class:"w-5 h-5 text-lime-400 mr-3 mt-0.5 flex-shrink-0"}),s("div",fe,[e[18]||(e[18]=s("p",{class:"text-sm font-medium text-lime-400"}," Orbit is already configured on this server! ",-1)),s("p",he,[u(" Status: "+m(i.value.orbit_running?"Running":"Not running")+" ",1),i.value.status?.projects?.length?(l(),r("span",be," · "+m(i.value.status.projects.length)+" project(s)",1)):d("",!0)]),e[19]||(e[19]=s("p",{class:"mt-2 text-sm text-zinc-500"}," You can add this environment without re-provisioning. ",-1))])])])):i.value?.can_connect&&!i.value?.has_orbit?(l(),r("div",ye,[s("div",xe,[a(t(q),{class:"w-5 h-5 text-blue-400 mr-3 mt-0.5 flex-shrink-0"}),s("div",ke,[s("p",ge," Connected successfully as "+m(i.value.connected_as),1),e[20]||(e[20]=s("p",{class:"mt-1 text-sm text-zinc-400"}," Orbit is not installed on this server. Provisioning will set it up. ",-1))])])])):i.value?.error?(l(),r("div",_e,[s("div",we,[a(t(Z),{class:"w-5 h-5 text-red-400 mr-3 mt-0.5 flex-shrink-0"}),s("div",Se,[e[21]||(e[21]=s("p",{class:"text-sm font-medium text-red-400"},"Connection Failed",-1)),s("p",Ce,m(i.value.error),1),s("button",{type:"button",onClick:e[6]||(e[6]=n=>g.value=!1),class:"mt-2 text-sm text-zinc-400 hover:text-white transition-colors"}," Try again ")])])])):d("",!0),i.value?.has_orbit?d("",!0):(l(),r("div",Ke,[a(t(w),{for:"ssh_public_key",class:"text-muted-foreground mb-2"},{default:c(()=>[...e[22]||(e[22]=[u(" SSH Public Key ",-1)])]),_:1}),L.value?I((l(),r("select",{key:0,"onUpdate:modelValue":e[7]||(e[7]=n=>S.value=n),class:"w-full"},[e[23]||(e[23]=s("option",{value:""},"Select a key...",-1)),p.sshKeys.length>0?(l(),r("optgroup",ze,[(l(!0),r(z,null,T(p.sshKeys,n=>(l(),r("option",{key:n.id,value:n.public_key},m(n.name)+" ("+m(n.key_type)+")"+m(n.is_default?" ★":""),9,Ve))),128))])):d("",!0),Object.keys(p.availableSshKeys).length>0?(l(),r("optgroup",Ae,[(l(!0),r(z,null,T(p.availableSshKeys,(n,N)=>(l(),r("option",{key:N,value:n.content},m(N)+" ("+m(n.type)+") ",9,Ee))),128))])):d("",!0),e[24]||(e[24]=s("option",{value:"custom"},"Enter custom key...",-1))],512)),[[W,S.value]]):d("",!0),B.value?I((l(),r("textarea",{key:1,"onUpdate:modelValue":e[8]||(e[8]=n=>t(o).ssh_public_key=n),id:"ssh_public_key",rows:"3",required:"",placeholder:"ssh-rsa AAAA...",class:"w-full mt-2 font-mono text-sm"},null,512)),[[G,t(o).ssh_public_key]]):d("",!0),e[25]||(e[25]=s("p",{class:"mt-2 text-sm text-muted-foreground"}," This key will be added to the orbit user on the remote machine ",-1)),t(o).errors.ssh_public_key?(l(),r("p",Le,m(t(o).errors.ssh_public_key),1)):d("",!0)]))]),i.value?.has_orbit?d("",!0):(l(),r("div",Ne,[...e[26]||(e[26]=[s("p",{class:"text-sm text-yellow-400"},[s("strong",null,"Note:"),u(" We'll first check if Orbit is already installed. If not, provisioning will make these changes: ")],-1),s("ul",{class:"mt-2 text-sm text-zinc-400 list-disc list-inside space-y-1"},[s("li",null,[u(" Create a "),s("code",{class:"bg-zinc-800 px-1 rounded text-zinc-300"},"orbit"),u(" user with sudo access ")]),s("li",null,"Disable SSH password authentication"),s("li",null,"Disable root SSH login"),s("li",null,"Install Docker"),s("li",null,"Install and initialize Orbit")],-1)])])),s("div",Oe,[i.value?.has_orbit?(l(),b(t(y),{key:0,type:"button",onClick:D,disabled:t(o).processing||!t(o).name,variant:"secondary"},{default:c(()=>[t(o).processing?(l(),b(t(A),{key:0,class:"w-4 h-4 animate-spin"})):d("",!0),e[27]||(e[27]=u(" Add ",-1))]),_:1},8,["disabled"])):(l(),b(t(y),{key:1,type:"submit",disabled:t(o).processing,variant:"secondary"},{default:c(()=>[t(o).processing?(l(),b(t(A),{key:0,class:"w-4 h-4 animate-spin"})):d("",!0),u(" "+m(t(o).processing?"Setting up...":"Provision"),1)]),_:1},8,["disabled"])),a(t(y),{"as-child":"",variant:"ghost"},{default:c(()=>[a(t(K),{href:"/servers"},{default:c(()=>[...e[28]||(e[28]=[u(" Cancel ",-1)])]),_:1})]),_:1})])],32))])],64))}});export{Be as default};
