import{c as Q,d as re,m as ce,x as de,O as ue,a,h as r,u as l,i as ve,b as e,t as o,g as p,w as x,o as n,f as h,e as d,S as me,n as O,F as f,E as fe,N as xe,j as W,r as c,q as D,M as T,v as $}from"./app-CY_syUay.js";import{a as k}from"./axios-AEiJBwY8.js";import{I as w,Y as J,A as pe,q as ge,k as be,B as G,$ as he}from"./craft-ui-EQePVbv_.js";import{L as K}from"./loader-circle-D6enBMLd.js";import{T as ye}from"./triangle-alert-DRt9sjZt.js";import{T as ze}from"./trash-2-CW--xrKr.js";const ke=Q("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);const we=Q("hard-drive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]),_e={class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between mb-8"},Ce={class:"flex items-center gap-3 min-w-0"},je={class:"text-2xl font-semibold tracking-tight text-zinc-100 truncate"},Ve={key:0,class:"px-2 py-0.5 text-xs font-mono bg-zinc-800 text-zinc-400 rounded-full flex-shrink-0"},Pe={class:"rounded-lg border border-zinc-800 bg-zinc-900/50 p-4 mb-6"},Le={class:"flex items-center justify-between"},Se={class:"flex items-center gap-4"},Ie={class:"flex h-10 w-10 items-center justify-center rounded-lg bg-lime-500/15"},Ae={class:"text-sm font-medium text-zinc-100 truncate max-w-[200px] sm:max-w-none"},Te={class:"flex items-center gap-2 mt-0.5"},$e={class:"relative flex h-2.5 w-2.5"},Ue={key:0,class:"absolute inline-flex h-full w-full rounded-full bg-lime-400 opacity-75 animate-ping motion-reduce:animate-none"},Ee={key:0,class:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6"},Oe={class:"flex flex-col gap-1 p-4 rounded-lg bg-zinc-800/30 border border-zinc-800"},De={class:"text-2xl font-semibold text-zinc-100 tabular-nums"},He={class:"flex flex-col gap-1 p-4 rounded-lg bg-zinc-800/30 border border-zinc-800"},Me={class:"text-2xl font-semibold text-zinc-100 tabular-nums"},Ne={class:"flex flex-col gap-1 p-4 rounded-lg bg-zinc-800/30 border border-zinc-800"},Ye={class:"text-2xl font-semibold text-zinc-100 tabular-nums"},Be={key:0,class:"text-xs text-zinc-500"},Fe={class:"flex flex-col gap-1 p-4 rounded-lg bg-zinc-800/30 border border-zinc-800"},qe={class:"rounded-lg border border-zinc-800 bg-zinc-900/50 mb-6"},Re={class:"flex items-center justify-between p-4 border-b border-zinc-800"},We={class:"p-4 space-y-4"},Je={class:"flex items-start gap-3"},Ge={class:"flex h-5 w-5 items-center justify-center rounded-full bg-lime-500/15 mt-0.5"},Ke={class:"text-sm text-lime-400 font-medium break-all"},Qe={class:"flex items-center gap-6 text-sm"},Xe={class:"ml-1 text-zinc-300 font-mono"},Ze={class:"flex items-start gap-3"},et={class:"flex h-5 w-5 items-center justify-center rounded-full bg-amber-500/15 mt-0.5"},tt={key:1,class:"text-zinc-500 text-sm"},st={key:1,class:"rounded-lg border border-zinc-800 bg-zinc-900/50 mb-6"},nt={class:"flex items-center justify-between p-4 border-b border-zinc-800"},at={key:0,class:"p-4 space-y-4"},lt={key:0,class:"text-zinc-500 text-sm"},it={class:"text-sm text-zinc-100 font-mono bg-zinc-800/50 rounded px-2 py-1.5"},ot={key:0},rt={key:1,class:"text-zinc-500"},ct={class:"flex items-center gap-8"},dt={class:"text-sm text-zinc-100 font-mono"},ut={class:"text-sm text-zinc-100 font-mono"},vt={key:1,class:"p-4 space-y-4"},mt={class:"space-y-2"},ft=["onClick"],xt={class:"mt-1 text-xs text-zinc-500"},pt={class:"flex gap-3 pt-2"},wt=re({__name:"Show",props:{environment:{},installation:{},editor:{},remoteApiUrl:{}},setup(u){const y=u,V=s=>y.remoteApiUrl?`${y.remoteApiUrl}${s}`:`/api/environments/${y.environment.id}${s}`,b=c(null),i=c("idle"),U=c("Connection not tested"),P=c({}),L=c(!0),H=D(()=>Object.values(P.value).filter(s=>s.status==="running").length),M=D(()=>Object.keys(P.value).length),N=c([]),S=c(!0),Y=c({}),v=c(null),E=c(!0),_=c(!1),I=c(!1),g=c([]),C=c(""),A=c("8.4"),j=c(!1),X=D(()=>v.value?.tld||"test");async function B(){i.value="testing",U.value="Testing connection...";try{const{data:s}=await k.post(`/api/environments/${y.environment.id}/test-connection`,{},{signal:b.value?.signal});i.value=s.success?"success":"error",U.value=s.message}catch(s){if(T.isCancel(s))return;i.value="error",U.value="Connection failed"}}async function Z(){L.value=!0;try{const t=await(await fetch(`${V("")}/status`,{signal:b.value?.signal})).json();t.success&&t.data?.services?P.value=t.data.services:t.services&&(P.value=t.services)}catch(s){if(s instanceof Error&&s.name==="AbortError")return;console.error("Failed to load services status:",s)}finally{L.value=!1}}async function F(){S.value=!0;try{const{data:s}=await k.get(V("/projects"),{signal:b.value?.signal});s.success&&s.data&&(N.value=s.data.projects||[])}catch(s){if(T.isCancel(s))return}finally{S.value=!1}}async function ee(){try{const{data:s}=await k.get(V("/worktrees"),{signal:b.value?.signal});if(s.success&&s.data?.worktrees){const t={};for(const m of s.data.worktrees)t[m.site]||(t[m.site]=[]),t[m.site].push(m);Y.value=t}}catch(s){if(T.isCancel(s))return}}async function te(){E.value=!0;try{const{data:s}=await k.get(V("/config"),{signal:b.value?.signal});s.success&&(v.value=s.data)}catch(s){if(T.isCancel(s))return}finally{E.value=!1}}async function se(){j.value=!0;try{const{data:s}=await k.post("/cli/install",{});s.success?window.location.reload():$.error("Failed to install CLI",{description:s.error||"Unknown error"})}catch{}finally{j.value=!1}}function ne(){v.value&&(g.value=[...v.value.paths||[]],g.value.length===0&&g.value.push(""),C.value=v.value.tld||"test",A.value=v.value.default_php_version||"8.4"),_.value=!0}function ae(){_.value=!1}function le(){g.value.push("")}function ie(s){g.value.splice(s,1)}async function oe(){const s=g.value.filter(t=>t.trim()!=="");if(s.length===0){$.error("Validation Error",{description:"Please add at least one site path"});return}I.value=!0;try{const{data:t}=await k.post(`/environments/${y.environment.id}/config`,{paths:s,tld:C.value.trim()||"test",default_php_version:A.value});t.success?(v.value=t.data,_.value=!1,$.success("Configuration saved"),await F()):$.error("Failed to save config",{description:t.error||"Unknown error"})}catch{}finally{I.value=!1}}let q=null;return ce(()=>{b.value=new AbortController,q=de.on("before",()=>{b.value?.abort()}),B(),y.installation.installed&&(te(),Z(),F(),ee())}),ue(()=>{q?.(),b.value?.abort()}),(s,t)=>(n(),a(f,null,[r(l(ve),{title:u.environment.name},null,8,["title"]),e("div",null,[e("header",_e,[e("div",Ce,[e("h1",je,o(u.environment.name),1),v.value?(n(),a("span",Ve,"."+o(X.value),1)):p("",!0)]),r(l(w),{onClick:B,variant:"outline",size:"sm",class:"bg-transparent border-zinc-700 text-zinc-300 hover:bg-zinc-800 hover:text-zinc-100"},{default:x(()=>[i.value==="testing"?(n(),h(l(K),{key:0,class:"w-4 h-4 mr-1.5 animate-spin motion-reduce:animate-none","aria-hidden":"true"})):p("",!0),t[2]||(t[2]=d(" Test Connection ",-1))]),_:1})]),e("div",Pe,[e("div",Le,[e("div",Se,[e("div",Ie,[u.environment.is_local?(n(),h(l(we),{key:0,class:"h-5 w-5 text-lime-400","aria-hidden":"true"})):(n(),h(l(me),{key:1,class:"h-5 w-5 text-lime-400","aria-hidden":"true"}))]),e("div",null,[e("p",Ae,o(u.environment.is_local?"Local Machine":`${u.environment.user}@${u.environment.host}`),1),e("div",Te,[e("span",$e,[i.value==="success"?(n(),a("span",Ue)):p("",!0),e("span",{class:O(["relative inline-flex rounded-full h-2.5 w-2.5",{"bg-zinc-600":i.value==="idle","bg-amber-400":i.value==="testing","bg-lime-400":i.value==="success","bg-red-400":i.value==="error"}])},null,2)]),e("span",{class:O(["text-sm",i.value==="success"?"text-zinc-100":"text-zinc-500"])},o(i.value==="success"?"Connected":i.value==="error"?"Disconnected":i.value==="testing"?"Testingâ€¦":"Not tested"),3)])])]),t[3]||(t[3]=e("div",{class:"text-right hidden sm:block"},[e("p",{class:"text-xs text-zinc-500"},"Last sync"),e("p",{class:"text-sm text-zinc-300"},"Just now")],-1))])]),u.installation.installed?(n(),a("div",Ee,[e("div",Oe,[t[4]||(t[4]=e("span",{class:"text-xs text-zinc-500 uppercase tracking-wide"},"Sites",-1)),e("span",De,[S.value?(n(),a(f,{key:0},[d("-")],64)):(n(),a(f,{key:1},[d(o(N.value.length),1)],64))])]),e("div",He,[t[5]||(t[5]=e("span",{class:"text-xs text-zinc-500 uppercase tracking-wide"},"Workspaces",-1)),e("span",Me,[S.value?(n(),a(f,{key:0},[d("-")],64)):(n(),a(f,{key:1},[d(o(Object.keys(Y.value).length),1)],64))])]),e("div",Ne,[t[6]||(t[6]=e("span",{class:"text-xs text-zinc-500 uppercase tracking-wide"},"Services",-1)),e("span",Ye,[L.value?(n(),a(f,{key:0},[d("-")],64)):(n(),a(f,{key:1},[d(o(H.value)+"/"+o(M.value),1)],64))]),!L.value&&H.value===M.value?(n(),a("span",Be,"All healthy")):p("",!0)]),e("div",Fe,[t[7]||(t[7]=e("span",{class:"text-xs text-zinc-500 uppercase tracking-wide"},"Status",-1)),e("span",{class:O(["text-2xl font-semibold tabular-nums",i.value==="success"?"text-lime-400":i.value==="error"?"text-red-400":"text-zinc-500"])},o(i.value==="success"?"Online":i.value==="error"?"Offline":"Checking"),3)])])):p("",!0),e("div",qe,[e("div",Re,[t[9]||(t[9]=e("h2",{class:"text-sm font-medium text-zinc-100"},"Orbit Installation",-1)),u.installation.installed?(n(),h(l(w),{key:0,variant:"ghost",size:"sm",class:"h-7 px-2 text-xs text-zinc-400 hover:text-zinc-100"},{default:x(()=>[r(l(fe),{class:"h-3.5 w-3.5 mr-1","aria-hidden":"true"}),t[8]||(t[8]=d(" Open ",-1))]),_:1})):p("",!0)]),e("div",We,[u.installation.installed?(n(),a(f,{key:0},[e("div",Je,[e("div",Ge,[r(l(xe),{class:"h-3 w-3 text-lime-400","aria-hidden":"true"})]),e("div",null,[e("p",Ke,o(u.installation.path),1),t[10]||(t[10]=e("p",{class:"text-xs text-zinc-500 mt-1"},"Installation verified",-1))])]),e("div",Qe,[e("div",null,[t[11]||(t[11]=e("span",{class:"text-zinc-500"},"Version:",-1)),e("span",Xe,o(u.installation.version),1)])])],64)):(n(),a(f,{key:1},[e("div",Ze,[e("div",et,[r(l(ye),{class:"h-3 w-3 text-amber-400","aria-hidden":"true"})]),t[12]||(t[12]=e("div",null,[e("p",{class:"text-sm text-amber-400 font-medium"},"Orbit CLI not found"),e("p",{class:"text-xs text-zinc-500 mt-1"},"Install to manage projects and services")],-1))]),u.environment.is_local?(n(),h(l(w),{key:0,onClick:se,disabled:j.value,variant:"outline",size:"sm",class:"bg-transparent border-zinc-700 text-zinc-300 hover:bg-zinc-800"},{default:x(()=>[j.value?(n(),h(l(K),{key:0,class:"w-4 h-4 animate-spin motion-reduce:animate-none mr-1.5","aria-hidden":"true"})):(n(),h(l(ke),{key:1,class:"w-4 h-4 mr-1.5","aria-hidden":"true"})),d(" "+o(j.value?"Installingâ€¦":"Install Orbit CLI"),1)]),_:1},8,["disabled"])):(n(),a("p",tt," Install orbit on this environment to manage projects. "))],64))])]),u.installation.installed?(n(),a("div",st,[e("div",nt,[t[14]||(t[14]=e("h2",{class:"text-sm font-medium text-zinc-100"},"Configuration",-1)),_.value?p("",!0):(n(),h(l(w),{key:0,onClick:ne,variant:"ghost",size:"sm",class:"h-7 px-2 text-xs text-zinc-400 hover:text-zinc-100"},{default:x(()=>[...t[13]||(t[13]=[d(" Edit ",-1)])]),_:1}))]),_.value?(n(),a("div",vt,[e("div",null,[t[18]||(t[18]=e("label",{class:"block text-xs text-zinc-500 mb-2"},"Site Paths",-1)),e("div",mt,[(n(!0),a(f,null,W(g.value,(m,z)=>(n(),a("div",{key:z,class:"flex items-center gap-2"},[r(l(J),{modelValue:g.value[z],"onUpdate:modelValue":R=>g.value[z]=R,type:"text",placeholder:"/home/user/sites",autocomplete:"off",class:"flex-1 font-mono text-sm"},null,8,["modelValue","onUpdate:modelValue"]),e("button",{onClick:R=>ie(z),class:"text-zinc-500 hover:text-red-400 focus-visible:text-red-400 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-red-400/50 p-2 rounded transition-colors","aria-label":"Remove path"},[r(l(ze),{class:"w-4 h-4","aria-hidden":"true"})],8,ft)]))),128))]),e("button",{onClick:le,class:"mt-2 text-xs text-zinc-400 hover:text-zinc-200 transition-colors"}," + Add path ")]),e("div",null,[t[19]||(t[19]=e("label",{for:"config-tld",class:"block text-xs text-zinc-500 mb-1"},"TLD",-1)),r(l(J),{modelValue:C.value,"onUpdate:modelValue":t[0]||(t[0]=m=>C.value=m),type:"text",id:"config-tld",name:"tld",placeholder:"test",autocomplete:"off",spellcheck:!1,class:"w-full max-w-xs font-mono text-sm"},null,8,["modelValue"]),e("p",xt," Sites will be accessible at sitename."+o(C.value||"test"),1)]),e("div",null,[t[22]||(t[22]=e("label",{for:"config-php",class:"block text-xs text-zinc-500 mb-1"},"Default PHP Version",-1)),r(l(he),{modelValue:A.value,"onUpdate:modelValue":t[1]||(t[1]=m=>A.value=m)},{default:x(()=>[r(l(pe),{class:"w-full max-w-xs"},{default:x(()=>[r(l(ge),{placeholder:"Select PHP version"})]),_:1}),r(l(be),null,{default:x(()=>[r(l(G),{value:"8.3"},{default:x(()=>[...t[20]||(t[20]=[d("PHP 8.3",-1)])]),_:1}),r(l(G),{value:"8.4"},{default:x(()=>[...t[21]||(t[21]=[d("PHP 8.4",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",pt,[r(l(w),{onClick:oe,disabled:I.value,size:"sm",class:"bg-lime-500 hover:bg-lime-600 text-zinc-950"},{default:x(()=>[d(o(I.value?"Savingâ€¦":"Save Changes"),1)]),_:1},8,["disabled"]),r(l(w),{onClick:ae,variant:"ghost",size:"sm"},{default:x(()=>[...t[23]||(t[23]=[d("Cancel",-1)])]),_:1})])])):(n(),a("div",at,[E.value?(n(),a("div",lt," Loading configuration\\u2026 ")):v.value?(n(),a(f,{key:1},[e("div",null,[t[15]||(t[15]=e("p",{class:"text-xs text-zinc-500 mb-1"},"Site Paths",-1)),e("p",it,[v.value.paths?.length?(n(!0),a(f,{key:0},W(v.value.paths,(m,z)=>(n(),a("span",{key:m},[d(o(m),1),z<v.value.paths.length-1?(n(),a("br",ot)):p("",!0)]))),128)):(n(),a("span",rt,"No paths configured"))])]),e("div",ct,[e("div",null,[t[16]||(t[16]=e("p",{class:"text-xs text-zinc-500 mb-1"},"TLD",-1)),e("p",dt,"."+o(v.value.tld||"test"),1)]),e("div",null,[t[17]||(t[17]=e("p",{class:"text-xs text-zinc-500 mb-1"},"Default PHP",-1)),e("p",ut,o(v.value.default_php_version||"8.4"),1)])])],64)):p("",!0)]))])):p("",!0)])],64))}});export{wt as default};
